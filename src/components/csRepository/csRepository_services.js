/*  --------------------------------------------------------------------------------
    Version history
    --------------------------------------------------------------------------------
    0.1 - initial version September 2014 Mark Farrall
    --------------------------------------------------------------------------------  */
	
angular.module('csRepository').factory('csRepository', function($q, Restangular) {

	var initialised = false;
	var apiPath = 'otcs/cs.exe/api/v1/';
	var authenticated = false;
	var ssoSupported = true;
	
	// private objects
	var restangular = configureConnection('/otcs/cs.exe/api/v1');
	var username = 'mark.farrall';
	var password = 'p@ssw0rd';

	// configure restangular
	function configureConnection(baseUrl, ticket) {
		return Restangular.withConfig(function(Configurer) {
			Configurer.setBaseUrl('/otcs/cs.exe/api/v1');
			if (ticket !== '') {
				Configurer.setDefaultHeaders({otcsticket: ticket});
			}
		});
	}
	
	// get a ticket for a specific username/password
	function checkTicket() {
		var deferred = $q.defer();

		restangular.one('auth').customPOST(
			{},
			'',
			{username: 'mark.farrall', password: 'p@ssw0rd'},
			{
				ContentType: 'application/x-www-form-urlencoded'
			}
		)
		.then(function(auth) {
			// todo test if we've got a ticket
			restangular = configureConnection(apiPath, auth.ticket);
			deferred.resolve(auth.ticket);
		});

		return deferred.promise;
	}
		
	// the the definition for a node
	var getNode = function(nodeId) {
		var deferred = $q.defer();
		
		// todo check if we need to refresh the ticket
		checkTicket()
		.then(function() {
			restangular.one('nodes', nodeId).get()
			.then(function(node) {
				deferred.resolve(node);
			});
		});
		// todo handle a ticket error
		
		return deferred.promise;
	};
	
	// get the children for a node
	var getChildren = function (parentId) {
		var deferred = $q.defer();
		
		// todo check if we need to refresh the ticket
		checkTicket()
		.then(function() {
			restangular.one('nodes', parentId).one('nodes').get()
			.then(function(nodes) {
				deferred.resolve(nodes);
			});
		});
		// todo handle a ticket error
		
		return deferred.promise;
		// todo - convert to real call
		/*var first =  {"data":[{"volume_id":-2000,"id":7942,"parent_id":2000,"name":"Sandpit","type":0,"description":"","create_date":"2014-09-02T03:03:03","modify_date":"2014-09-07T21:49:40","reserved":false,"reserved_user_id":0,"reserved_date":null,"icon":"/img/webdoc/folder.gif","mime_type":null,"original_id":0,"wnd_owner":1000,"wnd_createdby":1000,"wnd_createdate":"2014-09-02T03:03:03","wnd_modifiedby":1000,"wnd_version":null,"wnf_readydate":null,"type_name":"Folder","container":true,"size":2,"perm_see":true,"perm_see_contents":true,"perm_modify":true,"perm_modify_attributes":true,"perm_modify_permissions":true,"perm_create":true,"perm_delete":true,"perm_delete_versions":true,"perm_reserve":true,"cell_metadata":{"data":{"menu":"api/v1/nodes/7942/actions","name":"api/v1/nodes/7942/nodes","type":""},"definitions":{"menu":{"body":"","content_type":"","display_hint":"menu","display_href":"","handler":"menu","image":"","method":"GET","name":"","parameters":{},"tab_href":""},"name":{"body":"","content_type":"","display_hint":"link","display_href":"","handler":"table","image":"","method":"GET","name":"Sandpit","parameters":{"is_default_action":true},"tab_href":""},"type":{"body":"","content_type":"","display_hint":"icon","display_href":"","handler":"","image":"/img/webdoc/folder.gif","method":"","name":"Folder","parameters":{},"tab_href":""}}},"menu":null,"size_formatted":"2 Items","reserved_user_login":null,"action_url":"/v1/actions/7942","parent_id_url":"/v1/nodes/2000","actions":[{"name":"Open","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=browse","children":{},"signature":"Browse"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Configure","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=editconfig&nexturl=","children":{},"signature":"EditConfig"},{"name":"Order Custom Views","url":"/otcs/cs.exe?func=srch.ordercustomviews&objId=7942&nexturl=","children":{},"signature":"OrderCustomViews"},{"name":"Rename","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=rename&nexturl=","children":{},"signature":"Rename"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Add to Favorites","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=MakeFavorite&nexturl=","children":{},"signature":"MakeFavorite"},{"name":"Copy","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=copy&nexturl=","children":{},"signature":"Copy"},{"name":"Make Shortcut","url":"/otcs/cs.exe?func=ll&objType=1&objAction=Create&sourceID=7942&parentID=2000&nexturl=","children":{},"signature":"CreateAlias"},{"name":"Move","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=move&nexturl=","children":{},"signature":"Move"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Set Notification","url":"/otcs/cs.exe?func=notify.specificnode&Nodeid=7942&VolumeID=-2000&Subtype=0&Name=Sandpit&nexturl=","children":{},"signature":"SetNotification"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Make News","url":"/otcs/cs.exe?func=ll&objtype=208&objaction=create&createin&attachmentid=7942&nexturl=","children":{},"signature":"CreateNewsAndAttach"},{"name":"Pulse From Here","url":"/otcs/cs.exe?func=ll&objId=7942&objType=0&objAction=comment","children":{},"signature":"CommentFolder"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Permissions","url":"/otcs/cs.exe?func=ll&objAction=Permissions&objId=7942&id=7942&nexturl=","children":{},"signature":"Permissions"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Print","url":"/otcs/cs.exe?func=multifile.printmulti&nodeID_list=7942&nexturl=","children":{},"signature":"Print"},{"name":"Version Control","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=VersionControl&nexturl=","children":{},"signature":"VersionControl"},{"name":"WebDAV Folder View","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=webdavview","children":{},"signature":"WebDAVViewCmd"},{"name":"Zip & Download","url":"/otcs/cs.exe?func=multifile.zipdwnldmulti&nodeID_list=7942&nexturl=","children":{},"signature":"ZipDwnld"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Delete","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=delete&nexturl=","children":{},"signature":"Delete"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Properties","url":"","children":[{"children":{},"name":"General","signature":"Properties","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=properties&nexturl="},{"children":{},"name":"Audit","signature":"Audit","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=audit&nexturl="},{"children":{},"name":"Categories","signature":"InfoCmdCategories","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=attrvaluesedit&version=0&nexturl="},{"children":{},"name":"Classifications","signature":"Classifications","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=Classifications&nexturl="},{"children":{},"name":"Columns","signature":"Columns","url":"/otcs/cs.exe?func=ll&objid=7942&objAction=columns&nexturl="},{"children":{},"name":"Holds","signature":"HoldsDetail","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=HoldsDetail&nexturl="},{"children":{},"name":"Presentation","signature":"Catalog","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=catalog&nexturl="},{"children":{},"name":"Provenance","signature":"Provenance","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=Provenance&nexturl="},{"children":{},"name":"Records Detail","signature":"RecordsDetail","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=RecordsDetail&nexturl="},{"children":{},"name":"References","signature":"References","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=references&nexturl="},{"children":{},"name":"Security Clearance","signature":"SetRecmanSecurity","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=SetRecmanSecurity&activeTab=1&nexturl="},{"children":{},"name":"WebDAV","signature":"WebDAVInfoCmd","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=webdavinfo&nexturl="},{"children":{},"name":"XReference","signature":"XReference","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=XReference&nexturl="}],"signature":"PropertiesMenu"}]},{"volume_id":-2000,"id":8160,"parent_id":2000,"name":"System Configuration","type":0,"description":"","create_date":"2014-09-02T03:02:46","modify_date":"2014-09-02T03:02:46","reserved":false,"reserved_user_id":0,"reserved_date":null,"icon":"/img/webdoc/folder.gif","mime_type":null,"original_id":0,"wnd_owner":1000,"wnd_createdby":1000,"wnd_createdate":"2014-09-02T03:02:46","wnd_modifiedby":1000,"wnd_version":null,"wnf_readydate":null,"type_name":"Folder","container":true,"size":0,"perm_see":true,"perm_see_contents":true,"perm_modify":true,"perm_modify_attributes":true,"perm_modify_permissions":true,"perm_create":true,"perm_delete":true,"perm_delete_versions":true,"perm_reserve":true,"cell_metadata":{"data":{"menu":"api/v1/nodes/8160/actions","name":"api/v1/nodes/8160/nodes","type":""},"definitions":{"menu":{"body":"","content_type":"","display_hint":"menu","display_href":"","handler":"menu","image":"","method":"GET","name":"","parameters":{},"tab_href":""},"name":{"body":"","content_type":"","display_hint":"link","display_href":"","handler":"table","image":"","method":"GET","name":"System Configuration","parameters":{"is_default_action":true},"tab_href":""},"type":{"body":"","content_type":"","display_hint":"icon","display_href":"","handler":"","image":"/img/webdoc/folder.gif","method":"","name":"Folder","parameters":{},"tab_href":""}}},"menu":null,"size_formatted":"0 Items","reserved_user_login":null,"action_url":"/v1/actions/8160","parent_id_url":"/v1/nodes/2000","actions":[{"name":"Open","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=browse","children":{},"signature":"Browse"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Configure","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=editconfig&nexturl=","children":{},"signature":"EditConfig"},{"name":"Order Custom Views","url":"/otcs/cs.exe?func=srch.ordercustomviews&objId=8160&nexturl=","children":{},"signature":"OrderCustomViews"},{"name":"Rename","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=rename&nexturl=","children":{},"signature":"Rename"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Add to Favorites","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=MakeFavorite&nexturl=","children":{},"signature":"MakeFavorite"},{"name":"Copy","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=copy&nexturl=","children":{},"signature":"Copy"},{"name":"Make Shortcut","url":"/otcs/cs.exe?func=ll&objType=1&objAction=Create&sourceID=8160&parentID=2000&nexturl=","children":{},"signature":"CreateAlias"},{"name":"Move","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=move&nexturl=","children":{},"signature":"Move"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Set Notification","url":"/otcs/cs.exe?func=notify.specificnode&Nodeid=8160&VolumeID=-2000&Subtype=0&Name=System%20Configuration&nexturl=","children":{},"signature":"SetNotification"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Make News","url":"/otcs/cs.exe?func=ll&objtype=208&objaction=create&createin&attachmentid=8160&nexturl=","children":{},"signature":"CreateNewsAndAttach"},{"name":"Pulse From Here","url":"/otcs/cs.exe?func=ll&objId=8160&objType=0&objAction=comment","children":{},"signature":"CommentFolder"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Permissions","url":"/otcs/cs.exe?func=ll&objAction=Permissions&objId=8160&id=8160&nexturl=","children":{},"signature":"Permissions"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Print","url":"/otcs/cs.exe?func=multifile.printmulti&nodeID_list=8160&nexturl=","children":{},"signature":"Print"},{"name":"Version Control","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=VersionControl&nexturl=","children":{},"signature":"VersionControl"},{"name":"WebDAV Folder View","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=webdavview","children":{},"signature":"WebDAVViewCmd"},{"name":"Zip & Download","url":"/otcs/cs.exe?func=multifile.zipdwnldmulti&nodeID_list=8160&nexturl=","children":{},"signature":"ZipDwnld"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Delete","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=delete&nexturl=","children":{},"signature":"Delete"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Properties","url":"","children":[{"children":{},"name":"General","signature":"Properties","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=properties&nexturl="},{"children":{},"name":"Audit","signature":"Audit","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=audit&nexturl="},{"children":{},"name":"Categories","signature":"InfoCmdCategories","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=attrvaluesedit&version=0&nexturl="},{"children":{},"name":"Classifications","signature":"Classifications","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=Classifications&nexturl="},{"children":{},"name":"Columns","signature":"Columns","url":"/otcs/cs.exe?func=ll&objid=8160&objAction=columns&nexturl="},{"children":{},"name":"Holds","signature":"HoldsDetail","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=HoldsDetail&nexturl="},{"children":{},"name":"Presentation","signature":"Catalog","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=catalog&nexturl="},{"children":{},"name":"Provenance","signature":"Provenance","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=Provenance&nexturl="},{"children":{},"name":"Records Detail","signature":"RecordsDetail","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=RecordsDetail&nexturl="},{"children":{},"name":"References","signature":"References","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=references&nexturl="},{"children":{},"name":"Security Clearance","signature":"SetRecmanSecurity","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=SetRecmanSecurity&activeTab=1&nexturl="},{"children":{},"name":"WebDAV","signature":"WebDAVInfoCmd","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=webdavinfo&nexturl="},{"children":{},"name":"XReference","signature":"XReference","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=XReference&nexturl="}],"signature":"PropertiesMenu"}]}],"definitions":{"create_date":{"align":"center","name":"Created","persona":"","type":-7,"width_weight":0},"description":{"align":"left","name":"Description","persona":"","type":-1,"width_weight":100},"icon":{"align":"center","name":"Icon","persona":"","type":-1,"width_weight":0},"id":{"align":"right","name":"DataID","persona":"node","sort":true,"type":2,"width_weight":0},"mime_type":{"align":"left","name":"MIME Type","persona":"","type":-1,"width_weight":0},"modify_date":{"align":"left","name":"Modified","persona":"","sort":true,"type":-7,"width_weight":0},"name":{"align":"left","name":"Name","persona":"","sort":true,"type":-1,"width_weight":100},"original_id":{"align":"left","name":"Original ID","persona":"node","type":2,"width_weight":0},"parent_id":{"align":"left","name":"Parent ID","persona":"node","type":2,"width_weight":0},"reserved":{"align":"center","name":"Reserve","persona":"","type":5,"width_weight":0},"reserved_date":{"align":"center","name":"Reserved","persona":"","type":-7,"width_weight":0},"reserved_user_id":{"align":"center","name":"Reserved By","persona":"member","type":2,"width_weight":0},"size":{"align":"right","name":"Size","persona":"","sort":true,"sort_key":"size","type":2,"width_weight":0},"size_formatted":{"align":"right","name":"Size","persona":"","sort":true,"sort_key":"size","type":2,"width_weight":0},"type":{"align":"center","name":"Type","persona":"","sort":true,"type":2,"width_weight":0},"volume_id":{"align":"left","name":"VolumeID","persona":"node","type":2,"width_weight":0}},"definitions_map":{"name":["menu"]},"definitions_order":["type","name","size_formatted","modify_date","id"],"limit":25,"page":1,"page_total":1,"range_max":2,"range_min":1,"sort":"asc_name","total_count":2,"where_facet":[],"where_name":"","where_type":[]};
		var other =  {"data":[{"volume_id":-2000,"id":7942,"parent_id":2000,"name":"Sandpit","type":0,"description":"","create_date":"2014-09-02T03:03:03","modify_date":"2014-09-07T21:49:40","reserved":false,"reserved_user_id":0,"reserved_date":null,"icon":"/img/webdoc/folder.gif","mime_type":null,"original_id":0,"wnd_owner":1000,"wnd_createdby":1000,"wnd_createdate":"2014-09-02T03:03:03","wnd_modifiedby":1000,"wnd_version":null,"wnf_readydate":null,"type_name":"Folder","container":true,"size":2,"perm_see":true,"perm_see_contents":true,"perm_modify":true,"perm_modify_attributes":true,"perm_modify_permissions":true,"perm_create":true,"perm_delete":true,"perm_delete_versions":true,"perm_reserve":true,"cell_metadata":{"data":{"menu":"api/v1/nodes/7942/actions","name":"api/v1/nodes/7942/nodes","type":""},"definitions":{"menu":{"body":"","content_type":"","display_hint":"menu","display_href":"","handler":"menu","image":"","method":"GET","name":"","parameters":{},"tab_href":""},"name":{"body":"","content_type":"","display_hint":"link","display_href":"","handler":"table","image":"","method":"GET","name":"Sandpit","parameters":{"is_default_action":true},"tab_href":""},"type":{"body":"","content_type":"","display_hint":"icon","display_href":"","handler":"","image":"/img/webdoc/folder.gif","method":"","name":"Folder","parameters":{},"tab_href":""}}},"menu":null,"size_formatted":"2 Items","reserved_user_login":null,"action_url":"/v1/actions/7942","parent_id_url":"/v1/nodes/2000","actions":[{"name":"Open","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=browse","children":{},"signature":"Browse"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Configure","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=editconfig&nexturl=","children":{},"signature":"EditConfig"},{"name":"Order Custom Views","url":"/otcs/cs.exe?func=srch.ordercustomviews&objId=7942&nexturl=","children":{},"signature":"OrderCustomViews"},{"name":"Rename","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=rename&nexturl=","children":{},"signature":"Rename"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Add to Favorites","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=MakeFavorite&nexturl=","children":{},"signature":"MakeFavorite"},{"name":"Copy","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=copy&nexturl=","children":{},"signature":"Copy"},{"name":"Make Shortcut","url":"/otcs/cs.exe?func=ll&objType=1&objAction=Create&sourceID=7942&parentID=2000&nexturl=","children":{},"signature":"CreateAlias"},{"name":"Move","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=move&nexturl=","children":{},"signature":"Move"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Set Notification","url":"/otcs/cs.exe?func=notify.specificnode&Nodeid=7942&VolumeID=-2000&Subtype=0&Name=Sandpit&nexturl=","children":{},"signature":"SetNotification"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Make News","url":"/otcs/cs.exe?func=ll&objtype=208&objaction=create&createin&attachmentid=7942&nexturl=","children":{},"signature":"CreateNewsAndAttach"},{"name":"Pulse From Here","url":"/otcs/cs.exe?func=ll&objId=7942&objType=0&objAction=comment","children":{},"signature":"CommentFolder"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Permissions","url":"/otcs/cs.exe?func=ll&objAction=Permissions&objId=7942&id=7942&nexturl=","children":{},"signature":"Permissions"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Print","url":"/otcs/cs.exe?func=multifile.printmulti&nodeID_list=7942&nexturl=","children":{},"signature":"Print"},{"name":"Version Control","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=VersionControl&nexturl=","children":{},"signature":"VersionControl"},{"name":"WebDAV Folder View","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=webdavview","children":{},"signature":"WebDAVViewCmd"},{"name":"Zip & Download","url":"/otcs/cs.exe?func=multifile.zipdwnldmulti&nodeID_list=7942&nexturl=","children":{},"signature":"ZipDwnld"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Delete","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=delete&nexturl=","children":{},"signature":"Delete"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Properties","url":"","children":[{"children":{},"name":"General","signature":"Properties","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=properties&nexturl="},{"children":{},"name":"Audit","signature":"Audit","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=audit&nexturl="},{"children":{},"name":"Categories","signature":"InfoCmdCategories","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=attrvaluesedit&version=0&nexturl="},{"children":{},"name":"Classifications","signature":"Classifications","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=Classifications&nexturl="},{"children":{},"name":"Columns","signature":"Columns","url":"/otcs/cs.exe?func=ll&objid=7942&objAction=columns&nexturl="},{"children":{},"name":"Holds","signature":"HoldsDetail","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=HoldsDetail&nexturl="},{"children":{},"name":"Presentation","signature":"Catalog","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=catalog&nexturl="},{"children":{},"name":"Provenance","signature":"Provenance","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=Provenance&nexturl="},{"children":{},"name":"Records Detail","signature":"RecordsDetail","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=RecordsDetail&nexturl="},{"children":{},"name":"References","signature":"References","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=references&nexturl="},{"children":{},"name":"Security Clearance","signature":"SetRecmanSecurity","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=SetRecmanSecurity&activeTab=1&nexturl="},{"children":{},"name":"WebDAV","signature":"WebDAVInfoCmd","url":"/otcs/cs.exe?func=ll&objId=7942&objAction=webdavinfo&nexturl="},{"children":{},"name":"XReference","signature":"XReference","url":"/otcs/cs.exe?func=ll&objid=7942&objaction=XReference&nexturl="}],"signature":"PropertiesMenu"}]},{"volume_id":-2000,"id":8160,"parent_id":2000,"name":"System Configuration","type":0,"description":"","create_date":"2014-09-02T03:02:46","modify_date":"2014-09-02T03:02:46","reserved":false,"reserved_user_id":0,"reserved_date":null,"icon":"/img/webdoc/folder.gif","mime_type":null,"original_id":0,"wnd_owner":1000,"wnd_createdby":1000,"wnd_createdate":"2014-09-02T03:02:46","wnd_modifiedby":1000,"wnd_version":null,"wnf_readydate":null,"type_name":"Folder","container":true,"size":0,"perm_see":true,"perm_see_contents":true,"perm_modify":true,"perm_modify_attributes":true,"perm_modify_permissions":true,"perm_create":true,"perm_delete":true,"perm_delete_versions":true,"perm_reserve":true,"cell_metadata":{"data":{"menu":"api/v1/nodes/8160/actions","name":"api/v1/nodes/8160/nodes","type":""},"definitions":{"menu":{"body":"","content_type":"","display_hint":"menu","display_href":"","handler":"menu","image":"","method":"GET","name":"","parameters":{},"tab_href":""},"name":{"body":"","content_type":"","display_hint":"link","display_href":"","handler":"table","image":"","method":"GET","name":"System Configuration","parameters":{"is_default_action":true},"tab_href":""},"type":{"body":"","content_type":"","display_hint":"icon","display_href":"","handler":"","image":"/img/webdoc/folder.gif","method":"","name":"Folder","parameters":{},"tab_href":""}}},"menu":null,"size_formatted":"0 Items","reserved_user_login":null,"action_url":"/v1/actions/8160","parent_id_url":"/v1/nodes/2000","actions":[{"name":"Open","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=browse","children":{},"signature":"Browse"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Configure","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=editconfig&nexturl=","children":{},"signature":"EditConfig"},{"name":"Order Custom Views","url":"/otcs/cs.exe?func=srch.ordercustomviews&objId=8160&nexturl=","children":{},"signature":"OrderCustomViews"},{"name":"Rename","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=rename&nexturl=","children":{},"signature":"Rename"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Add to Favorites","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=MakeFavorite&nexturl=","children":{},"signature":"MakeFavorite"},{"name":"Copy","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=copy&nexturl=","children":{},"signature":"Copy"},{"name":"Make Shortcut","url":"/otcs/cs.exe?func=ll&objType=1&objAction=Create&sourceID=8160&parentID=2000&nexturl=","children":{},"signature":"CreateAlias"},{"name":"Move","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=move&nexturl=","children":{},"signature":"Move"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Set Notification","url":"/otcs/cs.exe?func=notify.specificnode&Nodeid=8160&VolumeID=-2000&Subtype=0&Name=System%20Configuration&nexturl=","children":{},"signature":"SetNotification"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Make News","url":"/otcs/cs.exe?func=ll&objtype=208&objaction=create&createin&attachmentid=8160&nexturl=","children":{},"signature":"CreateNewsAndAttach"},{"name":"Pulse From Here","url":"/otcs/cs.exe?func=ll&objId=8160&objType=0&objAction=comment","children":{},"signature":"CommentFolder"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Permissions","url":"/otcs/cs.exe?func=ll&objAction=Permissions&objId=8160&id=8160&nexturl=","children":{},"signature":"Permissions"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Print","url":"/otcs/cs.exe?func=multifile.printmulti&nodeID_list=8160&nexturl=","children":{},"signature":"Print"},{"name":"Version Control","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=VersionControl&nexturl=","children":{},"signature":"VersionControl"},{"name":"WebDAV Folder View","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=webdavview","children":{},"signature":"WebDAVViewCmd"},{"name":"Zip & Download","url":"/otcs/cs.exe?func=multifile.zipdwnldmulti&nodeID_list=8160&nexturl=","children":{},"signature":"ZipDwnld"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Delete","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=delete&nexturl=","children":{},"signature":"Delete"},{"name":"-","url":"","children":{},"signature":"-"},{"name":"Properties","url":"","children":[{"children":{},"name":"General","signature":"Properties","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=properties&nexturl="},{"children":{},"name":"Audit","signature":"Audit","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=audit&nexturl="},{"children":{},"name":"Categories","signature":"InfoCmdCategories","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=attrvaluesedit&version=0&nexturl="},{"children":{},"name":"Classifications","signature":"Classifications","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=Classifications&nexturl="},{"children":{},"name":"Columns","signature":"Columns","url":"/otcs/cs.exe?func=ll&objid=8160&objAction=columns&nexturl="},{"children":{},"name":"Holds","signature":"HoldsDetail","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=HoldsDetail&nexturl="},{"children":{},"name":"Presentation","signature":"Catalog","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=catalog&nexturl="},{"children":{},"name":"Provenance","signature":"Provenance","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=Provenance&nexturl="},{"children":{},"name":"Records Detail","signature":"RecordsDetail","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=RecordsDetail&nexturl="},{"children":{},"name":"References","signature":"References","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=references&nexturl="},{"children":{},"name":"Security Clearance","signature":"SetRecmanSecurity","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=SetRecmanSecurity&activeTab=1&nexturl="},{"children":{},"name":"WebDAV","signature":"WebDAVInfoCmd","url":"/otcs/cs.exe?func=ll&objId=8160&objAction=webdavinfo&nexturl="},{"children":{},"name":"XReference","signature":"XReference","url":"/otcs/cs.exe?func=ll&objid=8160&objaction=XReference&nexturl="}],"signature":"PropertiesMenu"}]}],"definitions":{"create_date":{"align":"center","name":"Created","persona":"","type":-7,"width_weight":0},"description":{"align":"left","name":"Description","persona":"","type":-1,"width_weight":100},"icon":{"align":"center","name":"Icon","persona":"","type":-1,"width_weight":0},"id":{"align":"right","name":"DataID","persona":"node","sort":true,"type":2,"width_weight":0},"mime_type":{"align":"left","name":"MIME Type","persona":"","type":-1,"width_weight":0},"modify_date":{"align":"left","name":"Modified","persona":"","sort":true,"type":-7,"width_weight":0},"name":{"align":"left","name":"Name","persona":"","sort":true,"type":-1,"width_weight":100},"original_id":{"align":"left","name":"Original ID","persona":"node","type":2,"width_weight":0},"parent_id":{"align":"left","name":"Parent ID","persona":"node","type":2,"width_weight":0},"reserved":{"align":"center","name":"Reserve","persona":"","type":5,"width_weight":0},"reserved_date":{"align":"center","name":"Reserved","persona":"","type":-7,"width_weight":0},"reserved_user_id":{"align":"center","name":"Reserved By","persona":"member","type":2,"width_weight":0},"size":{"align":"right","name":"Size","persona":"","sort":true,"sort_key":"size","type":2,"width_weight":0},"size_formatted":{"align":"right","name":"Size","persona":"","sort":true,"sort_key":"size","type":2,"width_weight":0},"type":{"align":"center","name":"Type","persona":"","sort":true,"type":2,"width_weight":0},"volume_id":{"align":"left","name":"VolumeID","persona":"node","type":2,"width_weight":0}},"definitions_map":{"name":["menu"]},"definitions_order":["type","name","size_formatted","modify_date","id"],"limit":25,"page":1,"page_total":1,"range_max":2,"range_min":1,"sort":"asc_name","total_count":2,"where_facet":[],"where_name":"","where_type":[]};
		if (parentId == 2000)
			return first;
		else
			return other;*/
    };
	
	// return the public functions
	return {
		initialised: initialised,
		apiPath: apiPath,
		authenticated: authenticated,
		ssoSupported: ssoSupported,
		getNode: getNode,
		getChildren: getChildren
	};
	
});

angular.module('csRepository').service('csLogin', function($modal) {

	var loginDialog = function() {
		return $modal.open({
			templateUrl: './views/csRepository/login.html',
			controller: 'LoginController',
			size: 'sm'
		});
	};
	
	return {
		showLogin: loginDialog
	};
	
	
});

